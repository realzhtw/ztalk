(struct fdport
           fd
           name
  &mutable is-open)

(def (fdport-read p buf start end)
  (unix-read (fdport-fd p) buf start end))

(def (fdport-write p buf start end)
  (unix-write (fdport-fd p) buf start end))

(def (fdport-seek p offset whence)
  (unix-lseek (fdport-fd p) offset whence))

(def (fdport-close p)
  (unix-close (fdport-fd p))
  (fdport-set-is-open p false))

(struct file-info
  dev inode mode nlinks uid gid rdev size
   atime mtime ctime block-size nblocks)

(def (fdport-stat p)
  (if-let info (unix-fstat (fdport-fd p))
    (annotate 'file-info info)
    nil))
